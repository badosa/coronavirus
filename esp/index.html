<!DOCTYPE html>
<html lang="en">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta charset="utf-8" />
		<title>Real-time Spain COVID-19 Stats</title>
    <link href="https://visual.js.org/visual.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
    <script src="https://visual.js.org/lazyvisualsetup.js"></script>
		<script src="https://cdn.jsdelivr.net/combine/npm/es6-promise@4.2.8,npm/whatwg-fetch@3.0.0"></script>
		<script src="https://unpkg.com/jsonstat-toolkit@1.0.8"></script>
		<style>
			#visual h1 {
				text-align: center;
				font-size: 20px;
			}
			#visual,
      #VisualJSTooltip {
        font-family: 'Lato', sans-serif;
        font-size: 14px;
      }
			.VisualJSfooter p {
				text-align: center;
			}
		</style>
	</head>

	<body>
		<div id="visual" class="visual"></div>
		<script>

		function ccaa(e){
			var c={
			  "Andalucía": "01",
			  "Aragón": "02",
			  "Asturias": "03",
			  "Baleares": "04",
			  "Canarias": "05",
			  "Cantabria": "06",
			  "Castilla y León": "07",
			  "Castilla-La Mancha": "08",
			  "Cataluña": "09",
			  "C. Valenciana": "10",
			  "Extremadura": "11",
			  "Galicia": "12",
			  "Madrid": "13",
			  "Murcia": "14",
			  "Navarra": "15",
			  "País Vasco": "16",
			  "La Rioja": "17",
			  "Ceuta": "18",
			  "Melilla": "19"
			};

			return c[e];
		}

		JSONstat("https://raw.githubusercontent.com/okaberocks/covid19-ccaa/master/etl/data/casos_ccaa_1_dato.json-stat").then(function(json){
			console.log(json);

			var data=json.Dimension("ccaa").id.map(ccaa).map(function(e,i){
				return {
					id: e,
					val: json.Data(i).value
				};
			});

			visual(
				{
					lang: "es",
					title: "Casos de COVID-19",
					footer: "Hora de recuperación de los datos: " + json.updated,
					dec: 0,
					range: 0,
					legend: true,
					type: "cmap",
					by: "spainnuts2",
					data: data
				}
			);

		});
		</script>
	</body>
</html>
