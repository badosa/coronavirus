<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="UTF-8">
  <title>Today COVID-19 Stats</title>
  <link href="https://visual.js.org/visual.css" rel="stylesheet" type="text/css" />
  <script src="https://visual.js.org/lazyvisualsetup.js"></script>
  <style>
  body {
    font-family: Verdana,Arial,Helvetica,sans-serif;
    font-size: 13px;
    margin: 10px 20px;
  }
  caption {
    text-align: left;
    font-weight: bold;
  }
  thead * {
    background-color: #333;
    color: #fff;
  }
  th {
    text-align: left;
  }
  .number {
    text-align: right;
  }
  #visual {
    float: left;
  }
  #table {
    height: 600px;
    width: 600px;
    overflow-y: scroll;
  }
  tr * {
    padding: 4px 10px;
  }
  tr.even * {
    background-color: #ddd;
  }
  tr.thou * {
    color: brown;
  }
  </style>
</head>
<body>
  <div id="visual" class="visual"></div>
  <div id="table">
    <table>
      <caption>Ranking by today cases (countries with more than 1,000 cases in brown)</caption>
      <thead>
        <tr>
          <th>Country</th><th class="number">Today Cases</th><th class="number">Today Deaths</th><th class="number">Total Cases</th><th class="number">Total Deaths</th><th class="number">Fatality Rate</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
  if(typeof fetch!=="function"){
    window.alert("Your browser is not modern enough to display this webpage. Sorry.");
  }

  fetch("https://corona.lmao.ninja/countries").then(function(resp){
    resp.json().then(function(data) {
      data.sort(function(a,b){
        return b.todayCases - a.todayCases;
      });

      var
        html=[],
        tbody=document.querySelector("tbody"),
        rank=data.filter(function(c){
          return c.todayCases>0 || c.cases>1000;
        }),
        chart=data.slice(0,10)
      ;

      rank.forEach(function(c,i){
        var
          even=i%2 ? "" : "even ",
          tho=c.cases>1000 ? "thou" : ""
        ;

        html.push('<tr class="'+even+tho+'"><td>'+c.country+'</td><td class="number">'+
          new Intl.NumberFormat('en-US').format(c.todayCases)+
          '</td><td class="number">'+
          new Intl.NumberFormat('en-US').format(c.todayDeaths)+
          '</td><td class="number">'+
          new Intl.NumberFormat('en-US').format(c.cases)+
          '</td><td class="number">'+
          new Intl.NumberFormat('en-US').format(c.deaths)+
          '</td><td class="number">'+
          new Intl.NumberFormat('en-US').format((c.deaths*100/c.cases).toFixed(2))+
            "%</td></tr>"
        );
      });

      tbody.innerHTML=html.join("");


      if(chart.length>9){
        visual({
          fixed: [600,600],
    			lang: "en",
          title: "Today COVID-19 Cases: 10 Top Countries So Far...",
          footer: "Warning: Different countries report cases at different hours. These data vary a lot over the course of the day.",
    			autoheading: false,
    			type: "rank",
    			data: chart.map(function(d){ return [d.country, d.todayCases]; })
    		});
      }else{
        document.querySelector("#visual").innerHTML="There are less than 10 countries reporting cases today. Take into account that different countries might report cases at different hours.";
      }


    });
  });
  </script>
</body>
</html>
